Организация контроллеров
========================

Когда ваше приложение начнёт определять слишком много контроллеров, вам захочется сгруппировать их логически::

    // определяем контроллеры для блога
    $blog = $app['controllers_factory'];
    $blog->get('/', function () {
        return 'Главная страница блога';
    });
    // ...

    // определяем контроллеры для форума
    $forum = $app['controllers_factory'];
    $forum->get('/', function () {
        return 'Главная страница форума';
    });

    // определяем "глобальные" контроллеры
    $app->get('/', function () {
        return 'Главная страница сайта';
    });

    $app->mount('/blog', $blog);
    $app->mount('/forum', $forum);

.. note::

    ``$app['controllers_factory']`` - это фабрика, которая при использовании возвращает новый экземпляр ``ControllerCollection``.

``mount()`` дополняет все маршруты указанным префиксом и объединяет их с главным приложением. Таким образом, ``/`` будет соответствовать главной странице сайта, ``/blog/`` - главной странице блога, а ``/forum/`` - главной странице форума.

.. caution::

    Когда коллекция маршрутов подключается как ``/blog``, нет никакой возможности определить маршрут для URL ``/blog``. Самый короткий возможный URL будет ``/blog/``.

.. note::

    При вызове ``get()``, ``match()`` или любого другого HTTP-метода в приложении, по факту вы вызываете их для экземпляра по умолчанию ``ControllerCollection`` (сохранённому в ``$app['controllers']``).

Ещё одним преимуществом является возможность очень простого применения настроек к набору контроллеров. Опираясь на пример из предыдущего раздела, мы продемонстрируем, как можно защитить все контроллеры бэкэнд-коллекции::

    $backend = $app['controllers_factory'];

    // требовать залогиненности пользователей
    $backend->before($mustBeLogged);

.. tip::

    Для лучшей читаемости вы можете разделить коллекции контроллеров по отдельным файлам::

        // blog.php
        $blog = $app['controllers_factory'];
        $blog->get('/', function () { return 'Главная страница блога'; });

        return $blog;

        // app.php
        $app->mount('/blog', include 'blog.php');

    Вместо разбиения по файлам, вы можете создать :doc:`провайдер Controller </providers#controllers-providers>`.
